---
import { type CollectionEntry, getCollection } from "astro:content";
import BaseHead from "@components/BaseHead.astro";
import BlogList from "@components/BlogList.astro";
import Footer from "@components/Footer.astro";
import Header from "@components/Header.astro";
import { POSTS_PER_PAGE, SITE_DESCRIPTION, SITE_TITLE } from "@data/constants";

export async function getStaticPaths() {
        const posts = (await getCollection("cPosts")).sort(
                (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
        );
        const totalPages = Math.max(1, Math.ceil(posts.length / POSTS_PER_PAGE));

        return Array.from({ length: Math.max(0, totalPages - 1) }, (_, index) => {
                const pageNumber = index + 2;
                const start = (pageNumber - 1) * POSTS_PER_PAGE;
                const end = start + POSTS_PER_PAGE;

                return {
                        params: { seite: String(pageNumber) },
                        props: {
                                posts: posts.slice(start, end),
                                pageNumber,
                                totalPages,
                        },
                };
        });
}

interface Props {
        posts: CollectionEntry<"cPosts">[];
        pageNumber: number;
        totalPages: number;
}

const { posts, pageNumber, totalPages } = Astro.props as Props;
---
<!doctype html>
<html lang="en">
        <head>
                <BaseHead title={`${SITE_TITLE} â€“ Seite ${pageNumber}`} description={SITE_DESCRIPTION} />
        </head>
        <body>
                <Header />
                <main>
                        <section>
                                <BlogList posts={posts} pageNumber={pageNumber} totalPages={totalPages} />
                        </section>
                </main>
                <Footer />
        </body>
</html>
